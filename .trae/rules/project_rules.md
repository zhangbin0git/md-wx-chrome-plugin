# Chrome 浏览器文章翻译插件 - AI 开发规则

本文档为 AI 助手在“Chrome 浏览器文章翻译插件”项目中的开发提供指导原则和规范，确保所有操作都符合项目架构和编码标准。

## 1. 核心原则

- **遵循技术架构**: 所有开发活动都必须严格遵守 `docs/technical-architecture.md` 中定义的技术架构和规范。
- **代码质量优先**: 优先考虑代码的可读性、可维护性和健壮性。
- **用户体验驱动**: 始终将用户体验放在首位，确保交互流畅、反馈及时。

## 2. 技术栈与框架

- **核心语言**: **TypeScript**。所有代码都必须使用 TypeScript 编写，并遵循 `tsconfig.json` 的严格模式。
- **核心框架**: **原生 JavaScript/TypeScript**。本项目不使用 React, Vue 等重型框架，以保持轻量和高性能。
- **UI**: **原生 HTML/CSS**。弹出页面的 UI 简洁，直接使用原生技术。
- **构建工具**: **Vite**。用于开发服务器和项目构建。
- **代码规范**: **ESLint + Prettier**。用于保证代码风格和质量的统一。

### NPM 包管理

- **内容提取**: 仅使用 `@mozilla/readability`。
- **HTML 转 Markdown**: 仅使用 `turndown`。
- **新包引入**:
    - 除非绝对必要，否则禁止引入新的 NPM 包。
    - 如果确实需要引入新包，必须先向用户提议并获得批准。
    - 优先选择轻量、无依赖或少依赖的库。

## 3. 项目目录结构

严格遵循以下目录结构。在创建新文件时，必须将其放置在正确的目录中。

```
md-wx-chrome-plugin/
├── docs/                      # 项目文档 (只读)
├── dist/                      # (AI 不应直接修改)
├── public/                    # 静态资源 (图标, manifest.json)
│   └── manifest.json          # (AI 可根据需求修改)
├── src/                       # 源代码
│   ├── background/            # 后台脚本
│   ├── content/               # 内容脚本
│   ├── popup/                 # 弹出页面 (HTML, CSS, TS)
│   ├── services/              # 公共服务 (如 AI 翻译, 存储)
│   └── utils/                 # 通用工具函数
├── package.json               # (AI 可根据需求修改)
├── tsconfig.json              # (AI 不应修改)
└── vite.config.ts             # (AI 不应修改)
```

## 4. 编码与代码风格规范

### 语言与风格
- **语言**: 统一使用 **TypeScript**。
- **格式化**: 所有代码提交前必须通过 **Prettier** 格式化。
- **质量检查**: 遵循 **ESLint** 的推荐规则。

### 命名规范
- **变量/函数**: 驼峰命名法 (camelCase)，例如 `fetchTranslation`。
- **类/类型/接口**: 帕斯卡命名法 (PascalCase)，例如 `class ArticleParser`。
- **常量**: 大写蛇形命名法 (UPPER_SNAKE_CASE)，例如 `const API_KEY`。
- **文件名**: 短横线命名法 (kebab-case)，例如 `ai-translator.ts`。

### 注释
- **函数/方法**: 必须添加 **JSDoc 风格**的函数级中文注释，清晰说明函数的功能、参数和返回值。
- **复杂逻辑**: 在复杂的算法或业务逻辑处，添加必要的行内中文注释。

### 模块化与错误处理
- **单一职责**: 每个文件/模块只做一件事。
- **模块系统**: 优先使用 ES6 模块 (`import`/`export`)。
- **错误处理**: 所有异步操作（如 `fetch`）都必须包含 `try...catch` 块，进行恰当的错误处理。禁止在控制台打印敏感信息。
- **异步编程**: 优先使用 `async/await`。

## 5. AI 助手任务执行规范

为确保开发过程的有序性和可控性，AI 助手必须严格遵循以下任务执行规范：

### 任务范围控制
- **严格按照任务拆分执行**: 必须严格按照 `docs/task_breakdown.md` 中定义的任务范围执行，不得超出指定任务的边界。
- **单一任务原则**: 每次只执行一个明确指定的任务（如"任务 1.1"、"任务 1.2"等），完成后等待用户确认再进行下一步。
- **禁止自动扩展**: 不得基于技术架构文档或其他文档自行扩展任务范围，如果需要扩展需要通知用户确认。

### 任务指令格式
用户应使用以下格式明确指定任务：
- **明确任务编号**: "请执行任务 X.X：[任务名称]"
- **范围限制**: "只完成任务 X.X 中列出的具体任务，不要超出范围"
- **停止指令**: "完成后等待我确认再进行下一步"

### 执行验收标准
- **任务完成确认**: 每个任务完成后，必须对照 `task_breakdown.md` 中的验收标准进行自检。
- **范围边界检查**: 确保所有创建的文件和代码都在指定任务范围内。
- **等待用户确认**: 任务完成后总结完成情况，等待用户确认后再进行下一个任务。

### 异常处理
- **任务描述不清晰**: 如果任务描述不清晰，应先询问具体范围而不是自行决定。
- **依赖关系处理**: 如果当前任务依赖其他未完成的任务，应明确指出依赖关系并等待用户指示。
- **超出范围的代码**: 如果发现已创建超出任务范围的代码，应主动询问是否需要清理。
