# 项目任务拆解文档

## 1. 概述

本文档基于项目需求、技术架构和 UI 设计，将“Chrome 浏览器文章翻译插件”的开发过程分解为一系列清晰、有序、可执行的任务。

拆解的核心目标是为 AI 开发人员提供一份明确的路线图，确保每一步开发都有据可依，每个模块都能独立完成并验证，最终高效、高质量地交付整个项目。

## 2. 任务拆解原则

- **优先级排序**: 优先构建核心功能和基础架构，再逐步完善 UI 交互和辅助功能。
- **模块化与独立性**: 任务按模块（如弹出页面、内容脚本、后台服务）划分，尽可能减少任务间的强依赖，便于独立开发和测试。
- **增量交付**: 每个阶段完成后，都应产出可见的、可运行的功能，例如先看到静态页面，再实现内容提取，最后展示翻译结果。
- **明确的验收标准**: 每个任务都关联相应的设计或需求文档，方便验证完成质量。

## 3. 任务分解蓝图

我们将整个开发过程分为六个主要阶段：

| 阶段 | 核心目标 | 产出成果 |
| :--- | :--- | :--- |
| **第一阶段** | **项目初始化与基础 UI 搭建** | 一个可运行的、包含静态初始页面的 Chrome 插件骨架。 |
| **第二阶段** | **核心内容提取与格式转换** | 实现从任意文章页面提取正文并转换为 Markdown 的核心能力。 |
| **第三阶段** | **实现核心通信与数据流转** | 打通插件内部各模块（Popup, Content, Background）的通信链路。 |
| **第四阶段** | **集成 AI 翻译服务** | 实现调用外部大模型进行文本翻译的功能。 |
| **第五阶段** | **结果展示与最终 UI/UX** | 在前端以打字机效果动态展示翻译结果，完善最终界面。 |
| **第六阶段** | **功能完善与持久化** | 实现复制、下载、重新生成和本地存储等高级功能。 |

---

### **第一阶段：项目初始化与基础 UI 搭建**

**目标**: 搭建项目的基础结构，创建符合 `示意图-弹出页面.md` 设计的静态初始界面。

| 任务 ID | 任务描述 | 核心实现 | 验收标准 |
| :--- | :--- | :--- | :--- |
| **1.1** | **初始化项目结构** | - 根据 `technical-architecture.md` 创建所有目录和空文件。<br>- 配置 `package.json`、`vite.config.ts`、`tsconfig.json`。<br>- 配置 `public/manifest.json`，使其能作为 Chrome 插件加载。 | - 项目能通过 Vite 正常启动。<br>- 插件能被加载到 Chrome，并显示工具栏图标。 |
| **1.2** | **实现弹出页 - 初始状态 UI** | - 编写 `popup/index.html`，搭建“初始状态”的 DOM 结构。<br>- 编写 `popup/style.css`，实现“初始状态”的视觉样式，包括标题、插画占位符和“立即翻译”按钮。<br>- 确保 UI 布局与 `示意图-弹出页面.md` 中的设计一致。 | - 点击插件图标，弹出的页面与“初始状态”示意图完全一致。<br>- 页面具备基础的响应式能力。 |

### **第二阶段：核心内容提取与格式转换**

**目标**: 实现插件的核心能力——从网页中提取正文并转换为干净的 Markdown。

| 任务 ID | 任务描述 | 核心实现 | 验收标准 |
| :--- | :--- | :--- | :--- |
| **2.1** | **实现内容脚本 - 文章提取** | - 在 `content/index.ts` 中，使用 `@mozilla/readability` 库提取当前页面的 `title` 和 `content` (HTML)。 | - 在任意一篇新闻或博客文章页面，内容脚本能准确提取出文章标题和正文 HTML。 |
| **2.2** | **实现 Markdown 转换工具** | - 在 `utils/markdown-converter.ts` 中，创建一个服务。<br>- 使用 `turndown` 库将 `readability` 提取的 HTML 转换为 Markdown。<br>- 添加自定义规则，确保 `<img>` 标签能被正确转换为 `![alt](src)` 格式。 | - 输入一段包含图片和各类文本格式的 HTML，能输出格式正确的 Markdown。 |

### **第三阶段：实现核心通信与数据流转**

**目标**: 打通“弹出页面 (Popup)”、“后台脚本 (Background)”和“内容脚本 (Content)”之间的通信，实现完整的“提取 -> 转换”流程。

| 任务 ID | 任务描述 | 核心实现 | 验收标准 |
| :--- | :--- | :--- | :--- |
| **3.1** | **建立核心通信渠道** | - **Popup**: 点击“立即翻译”后，向 Background 发送“开始翻译”消息。<br>- **Background**: 接收到消息后，向当前激活的 Tab 页的 Content Script 发送“提取内容”请求。<br>- **Content**: 接收到请求，执行提取和转换，将最终的 Markdown 文本返回给 Background。 | - 在文章页面点击“立即翻译”，后台脚本能接收到内容脚本处理好的 Markdown 文本（可通过 `console.log` 验证）。 |
| **3.2** | **实现处理中状态 UI** | - 根据 `示意图-弹出页面.md`，创建“处理中状态”的 HTML/CSS。<br>- 在 `popup/script.ts` 中实现状态切换逻辑：点击翻译后，页面从“初始状态”切换到“处理中状态”。<br>- 实现进度指示器文本的动态更新逻辑（例如，接收到 Background 的消息后更新文本为“正在翻译... (3/3)”）。 | - 点击“立即翻译”后，UI 立刻切换到加载动画和进度指示器界面。 |

### **第四阶段：集成 AI 翻译服务**

**目标**: 将上一步获取的 Markdown 文本发送给 AI 大模型进行翻译。

| 任务 ID | 任务描述 | 核心实现 | 验收标准 |
| :--- | :--- | :--- | :--- |
| **4.1** | **实现 AI 翻译服务模块** | - 在 `services/ai-translator.ts` 中，封装一个函数。<br>- 使用原生 `fetch` API 调用一个兼容 OpenAI SDK 的流式接口。<br>- 函数接收 Markdown 文本作为输入，返回一个可读的响应流 (ReadableStream)。 | - 能够独立调用该函数，传入一段英文 Markdown，能接收到翻译后的中文文本流。 |
| **4.2** | **后台脚本集成翻译功能** | - 在 `background/index.ts` 中，当从内容脚本接收到 Markdown 文本后，立即调用 `ai-translator.ts` 中的翻译服务。<br>- 将获取到的翻译文本流实时转发给弹出页面 (Popup)。 | - 后台脚本能成功触发翻译，并将 AI 返回的文本流正确地发送给弹出页面。 |

### **第五阶段：结果展示与最终 UI/UX**

**目标**: 将翻译结果以优雅的“打字机”效果展示给用户，并完成最终的 UI 布局。

| 任务 ID | 任务描述 | 核心实现 | 验收标准 |
| :--- | :--- | :--- | :--- |
| **5.1** | **实现结果展示 UI 与打字机效果** | - 根据 `示意图-弹出页面.md`，创建“结果展示状态”的 HTML/CSS。<br>- 在 `popup/script.ts` 中，实现一个 `typewriter` 函数，该函数能读取从 Background 传来的文本流，并逐字或逐词地渲染到页面的指定区域。<br>- 实现状态切换：翻译流开始时，页面从“处理中”切换到“结果展示”。 | - 翻译结果以流畅的打字机动画效果呈现在页面上。 |
| **5.2** | **格式化并展示完整结果** | - 从内容脚本处获取文章元数据（标题、作者、URL）。<br>- 按照 `requirement.md` 中“4. 输出格式规范”的要求，将标题、作者、原文链接和翻译正文完整地渲染到结果页面。 | - 最终展示的页面内容与输出格式规范完全一致。 |

### **第六阶段：功能完善与持久化**

**目标**: 实现所有辅助操作功能，并增加数据持久化，提升插件的完整性和用户体验。

| 任务 ID | 任务描述 | 核心实现 | 验收标准 |
| :--- | :--- | :--- | :--- |
| **6.1** | **实现顶部操作栏功能** | - 为“复制”、“下载 .md”、“重新生成”和“返回”按钮绑定事件。<br>- **复制**: 将生成的 Markdown 结果复制到剪贴板。<br>- **下载**: 将结果生成 `.md` 文件并触发浏览器下载。<br>- **重新生成**: 再次触发翻译流程。<br>- **返回**: 将 UI 切回“初始状态”。 | - 所有顶部操作按钮功能均可正常使用。 |
| **6.2** | **实现本地存储** | - 创建 `services/storage.ts`，封装 `chrome.storage.local` 的 `get` 和 `set` 方法。<br>- 在 `background/index.ts` 中，每当翻译成功后，调用存储服务，将最终的 Markdown 结果保存到本地。<br>- 当用户打开弹出页面时，优先从本地加载上一次的翻译结果并直接展示。 | - 关闭并重新打开弹出页面，能立即看到上一次的翻译结果。 |
| **6.3** | **最终审查与优化** | - 检查所有状态切换的动画效果是否流畅。<br>- 检查并处理所有可能的错误情况（如网络失败、内容提取失败）。<br>- 对代码进行最终的代码风格和注释审查。 | - 插件运行稳定，交互流畅，代码整洁，符合所有文档规范。 |
